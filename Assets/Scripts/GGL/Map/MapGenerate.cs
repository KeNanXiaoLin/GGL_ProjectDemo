using System;
using System.Collections;
using System.Collections.Generic;
using KNXL.AutoGenerated.Data;
using UnityEngine;

public class MapGenerate : MonoBehaviour
{
    public GameObject prefab;

    void Start()
    {
        ConfigTable<CfgMapData> mapData = ConfigManager.Instance.GetTable<CfgMapData>();
        foreach (var item in mapData.AllData)
        {
            SpawnItem(item);
        }
    }

    public void SpawnItem(CfgMapData item)
    {
        Vector2 worldPos = GameManager.Instance.mapCell.CellToWorldCenter(new Cell(item.x, item.y));
        GameObject obj = null;
        CfgMaskData maskData = ConfigManager.Instance.GetTable<CfgMaskData>().GetData(item.maskID);
        obj = Instantiate(prefab, new Vector3(worldPos.x, worldPos.y, 0), Quaternion.identity);
        Mask maskObj = obj.GetComponent<Mask>();
        maskObj.abilityData = maskData;
        maskObj.abilityID = maskData.id;
        
        if (maskObj != null)
        {
            Sprite sp = Resources.Load<Sprite>(maskData.spritePath);
            maskObj.spriteRenderer.sprite = sp;
            Cell targetCell = GameManager.Instance.mapCell.WorldToCell(worldPos);
            targetCell.SetAbility(maskObj);
        }
    }

    public void SpawnItem(CfgMaskData maskData,Vector2 worldPos)
    {
        GameObject obj = null;
        obj = Instantiate(prefab, new Vector3(worldPos.x, worldPos.y, 0), Quaternion.identity);
        Mask maskObj = obj.GetComponent<Mask>();
        maskObj.abilityData = maskData;
        maskObj.abilityID = maskData.id;
        
        if (maskObj != null)
        {
            Sprite sp = Resources.Load<Sprite>(maskData.spritePath);
            maskObj.spriteRenderer.sprite = sp;
            Cell targetCell = GameManager.Instance.mapCell.WorldToCell(worldPos);
            targetCell.SetAbility(maskObj);
        }
    }

}
